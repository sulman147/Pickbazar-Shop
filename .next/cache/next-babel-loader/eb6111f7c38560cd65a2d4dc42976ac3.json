{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"E:\\\\React Web Work\\\\pickbazar\\\\packages\\\\shop\\\\contexts\\\\cart\\\\cart.provider.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Currency from 'currency.js';\nimport React, { useState, useReducer } from 'react';\nimport { getLocalState, setLocalState } from 'helper/localStorage';\nimport { cartAnimation } from 'helper/utility';\nimport { CartContext } from './cart.context';\nvar initialState = {\n  isOpen: false\n};\n\nfunction reducer(cartState, action) {\n  switch (action.type) {\n    case 'TOGGLE':\n      return _objectSpread({}, cartState, {\n        isOpen: !cartState.isOpen\n      });\n\n    default:\n      return cartState;\n  }\n}\n\nvar getCartProducts = function getCartProducts() {\n  var products = getLocalState('cart');\n  return products ? products : [];\n};\n\nvar getTotalPrice = function getTotalPrice() {\n  var price = getLocalState('totalPrice');\n  return price ? price : 0;\n};\n\nvar getCoupon = function getCoupon() {\n  var coupon = getLocalState('coupon');\n  if (coupon) return coupon;\n  return {\n    id: 0,\n    code: 'DEFAULT_COUPON',\n    discountInPercent: 0\n  };\n};\n\nvar getDiscount = function getDiscount() {\n  var discount = getLocalState('discount');\n  return discount ? discount : 0;\n};\n\nexport var CartProvider = function CartProvider(props) {\n  var _useReducer = useReducer(reducer, initialState),\n      cartState = _useReducer[0],\n      dispatch = _useReducer[1];\n\n  var _useState = useState(getCartProducts()),\n      products = _useState[0],\n      setProducts = _useState[1];\n\n  var _useState2 = useState(getTotalPrice()),\n      totalPrice = _useState2[0],\n      setTotalPrice = _useState2[1];\n\n  var _useState3 = useState(getTotalPrice()),\n      subtotalPrice = _useState3[0],\n      setSubTotalPrice = _useState3[1];\n\n  var _useState4 = useState(getCoupon()),\n      coupon = _useState4[0],\n      setCoupon = _useState4[1];\n\n  var _useState5 = useState(getDiscount()),\n      discount = _useState5[0],\n      setDiscount = _useState5[1];\n\n  var setPrice = function setPrice() {\n    var coupon = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getCoupon();\n    var price = calculateTotalPrice(products, coupon);\n    setLocalState('totalPrice', price);\n    setTotalPrice(price);\n  };\n\n  var calculateTotalPrice = function calculateTotalPrice(products, coupon) {\n    var total = Currency(0);\n    var finalTotal;\n    products.forEach(function (product) {\n      var quantity = product.quantity ? product.quantity : 1;\n      var price = product.salePrice ? product.salePrice : product.price;\n      var itemPrice = Currency(quantity).multiply(price);\n      total = Currency(total).add(itemPrice);\n    });\n    finalTotal = Number(total.value);\n    setLocalState('subTotalPrice', finalTotal);\n    setSubTotalPrice(finalTotal);\n\n    if (coupon.discountInPercent) {\n      var _discount = finalTotal * Number(coupon.discountInPercent) / 100;\n\n      setLocalState('discount', _discount);\n      setDiscount(_discount);\n      finalTotal = finalTotal - _discount;\n    }\n\n    return finalTotal;\n  };\n\n  var add = function add(event, item) {\n    // TODO: cookie storage\n    if (products.length) {\n      var index = products.findIndex(function (product) {\n        return product.id === item.id;\n      });\n\n      if (index !== -1) {\n        // if product already available in the cart\n        var product = products[index];\n        var quantity = product.quantity ? product.quantity : 0;\n        products[index] = _objectSpread({}, product, {}, item, {\n          quantity: quantity + 1\n        }); // just increase the quantity\n      } else {\n        // if this product is not available in the cart\n        products.push(_objectSpread({}, item, {\n          quantity: 1\n        }));\n      }\n    } else {\n      // if the cart is empty\n      products.push(_objectSpread({}, item, {\n        quantity: 1\n      }));\n    }\n\n    cartAnimation(event);\n    setLocalState('cart', products);\n    setProducts(_toConsumableArray(products)); // have to use the shallow copy [...products]\n\n    setPrice();\n  };\n\n  var addCoupon = function addCoupon(coupon) {\n    setLocalState('coupon', coupon);\n    setCoupon(coupon);\n    setPrice(coupon);\n  };\n\n  var removeCoupon = function removeCoupon() {\n    setLocalState('coupon', {\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0\n    });\n    setLocalState('discount', 0);\n    setCoupon({\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0\n    });\n    setPrice({\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0\n    });\n  };\n\n  var update = function update(itemId, quantity) {\n    var index = products.findIndex(function (product) {\n      return product.id === itemId;\n    });\n\n    if (quantity < 1 && index > -1) {\n      // delete if quantity, 0\n      products.splice(index, 1);\n    } else {\n      // update quanity\n      var product = products[index];\n      products[index] = _objectSpread({}, product, {\n        quantity: quantity\n      });\n    }\n\n    setLocalState('cart', products);\n    setProducts(_toConsumableArray(products));\n\n    if (!products.length) {\n      setLocalState('coupon', {\n        id: 0,\n        code: 'DEFAULT_COUPON',\n        discountInPercent: 0\n      });\n      setLocalState('discount', 0);\n      setDiscount(0);\n      setCoupon({\n        id: 0,\n        code: 'DEFAULT_COUPON',\n        discountInPercent: 0\n      });\n    }\n\n    setPrice();\n  };\n\n  var clearCart = function clearCart() {\n    setLocalState('cart', []);\n    setProducts([]);\n    setLocalState('discount', 0);\n    setDiscount(0);\n    setCoupon({\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0\n    });\n    setLocalState('coupon', {\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0\n    }); // setPrice();\n\n    setLocalState('totalPrice', 0);\n    setTotalPrice(0);\n    setLocalState('subTotalPrice', 0);\n    setSubTotalPrice(0);\n  };\n\n  return __jsx(CartContext.Provider, {\n    value: {\n      cartState: cartState,\n      dispatch: dispatch,\n      products: products,\n      add: add,\n      update: update,\n      totalPrice: totalPrice,\n      addCoupon: addCoupon,\n      coupon: coupon,\n      discount: discount,\n      removeCoupon: removeCoupon,\n      subtotalPrice: subtotalPrice,\n      clearCart: clearCart\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, props.children);\n};","map":{"version":3,"sources":["E:/React Web Work/pickbazar/packages/shop/contexts/cart/cart.provider.tsx"],"names":["Currency","React","useState","useReducer","getLocalState","setLocalState","cartAnimation","CartContext","initialState","isOpen","reducer","cartState","action","type","getCartProducts","products","getTotalPrice","price","getCoupon","coupon","id","code","discountInPercent","getDiscount","discount","CartProvider","props","dispatch","setProducts","totalPrice","setTotalPrice","subtotalPrice","setSubTotalPrice","setCoupon","setDiscount","setPrice","calculateTotalPrice","total","finalTotal","forEach","product","quantity","salePrice","itemPrice","multiply","add","Number","value","event","item","length","index","findIndex","push","addCoupon","removeCoupon","update","itemId","splice","clearCart","children"],"mappings":"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","sourcesContent":["import Currency from 'currency.js';\nimport React, { useState, useReducer } from 'react';\nimport { getLocalState, setLocalState } from 'helper/localStorage';\nimport { cartAnimation } from 'helper/utility';\nimport { Product, Coupon } from 'interfaces';\nimport { CartContext } from './cart.context';\n\nconst initialState = {\n  isOpen: false,\n};\n\nfunction reducer(cartState: any, action: any) {\n  switch (action.type) {\n    case 'TOGGLE':\n      return {\n        ...cartState,\n        isOpen: !cartState.isOpen,\n      };\n    default:\n      return cartState;\n  }\n}\n\nconst getCartProducts = () => {\n  const products = getLocalState('cart');\n  return products ? products : [];\n};\n\nconst getTotalPrice = () => {\n  const price = getLocalState('totalPrice');\n  return price ? price : 0;\n};\n\nconst getCoupon = () => {\n  const coupon = getLocalState('coupon');\n\n  if (coupon) return coupon;\n\n  return {\n    id: 0,\n    code: 'DEFAULT_COUPON',\n    discountInPercent: 0,\n  };\n};\nconst getDiscount = () => {\n  const discount = getLocalState('discount');\n  return discount ? discount : 0;\n};\n\nexport const CartProvider = (props: any) => {\n  const [cartState, dispatch] = useReducer(reducer, initialState);\n  const [products, setProducts] = useState(getCartProducts() as Product[]);\n  const [totalPrice, setTotalPrice] = useState(getTotalPrice() as number);\n  const [subtotalPrice, setSubTotalPrice] = useState(getTotalPrice() as number);\n  const [coupon, setCoupon] = useState(getCoupon() as Coupon);\n  const [discount, setDiscount] = useState(getDiscount() as number);\n  const setPrice = (coupon = getCoupon()) => {\n    const price = calculateTotalPrice(products, coupon);\n    setLocalState('totalPrice', price);\n    setTotalPrice(price);\n  };\n  const calculateTotalPrice = (products: Product[], coupon: Coupon): number => {\n    let total = Currency(0);\n    let finalTotal;\n    products.forEach(product => {\n      const quantity = product.quantity ? product.quantity : 1;\n      const price = product.salePrice ? product.salePrice : product.price;\n      const itemPrice = Currency(quantity).multiply(price);\n      total = Currency(total).add(itemPrice);\n    });\n    finalTotal = Number(total.value);\n    setLocalState('subTotalPrice', finalTotal);\n    setSubTotalPrice(finalTotal);\n    if (coupon.discountInPercent) {\n      const discount = (finalTotal * Number(coupon.discountInPercent)) / 100;\n      setLocalState('discount', discount);\n      setDiscount(discount);\n      finalTotal = finalTotal - discount;\n    }\n    return finalTotal;\n  };\n  const add = (event, item: Product) => {\n    // TODO: cookie storage\n    if (products.length) {\n      const index = products.findIndex(product => product.id === item.id);\n      if (index !== -1) {\n        // if product already available in the cart\n        const product = products[index];\n        const quantity = product.quantity ? product.quantity : 0;\n        products[index] = { ...product, ...item, quantity: quantity + 1 }; // just increase the quantity\n      } else {\n        // if this product is not available in the cart\n        products.push({ ...item, quantity: 1 });\n      }\n    } else {\n      // if the cart is empty\n      products.push({ ...item, quantity: 1 });\n    }\n\n    cartAnimation(event);\n\n    setLocalState('cart', products);\n    setProducts([...products]); // have to use the shallow copy [...products]\n    setPrice();\n  };\n\n  const addCoupon = (coupon: Coupon) => {\n    setLocalState('coupon', coupon);\n    setCoupon(coupon);\n    setPrice(coupon);\n  };\n\n  const removeCoupon = () => {\n    setLocalState('coupon', {\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0,\n    });\n    setLocalState('discount', 0);\n    setCoupon({\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0,\n    });\n    setPrice({\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0,\n    });\n  };\n\n  const update = (itemId: any, quantity: number) => {\n    const index = products.findIndex(product => product.id === itemId);\n    if (quantity < 1 && index > -1) {\n      // delete if quantity, 0\n      products.splice(index, 1);\n    } else {\n      // update quanity\n      const product = products[index];\n      products[index] = { ...product, quantity };\n    }\n\n    setLocalState('cart', products);\n    setProducts([...products]);\n    if (!products.length) {\n      setLocalState('coupon', {\n        id: 0,\n        code: 'DEFAULT_COUPON',\n        discountInPercent: 0,\n      });\n      setLocalState('discount', 0);\n      setDiscount(0);\n      setCoupon({\n        id: 0,\n        code: 'DEFAULT_COUPON',\n        discountInPercent: 0,\n      });\n    }\n    setPrice();\n  };\n\n  const clearCart = () => {\n    setLocalState('cart', []);\n    setProducts([]);\n    setLocalState('discount', 0);\n    setDiscount(0);\n    setCoupon({\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0,\n    });\n    setLocalState('coupon', {\n      id: 0,\n      code: 'DEFAULT_COUPON',\n      discountInPercent: 0,\n    });\n    // setPrice();\n    setLocalState('totalPrice', 0);\n    setTotalPrice(0);\n    setLocalState('subTotalPrice', 0);\n    setSubTotalPrice(0);\n  };\n\n  return (\n    <CartContext.Provider\n      value={{\n        cartState,\n        dispatch,\n        products,\n        add,\n        update,\n        totalPrice,\n        addCoupon,\n        coupon,\n        discount,\n        removeCoupon,\n        subtotalPrice,\n        clearCart,\n      }}\n    >\n      {props.children}\n    </CartContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}